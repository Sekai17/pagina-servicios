<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>RPG de Texto ‚Äî Santuario</title>
<style>
:root{--bg:#111;--fg:#eee;--accent:#4ade80;font-family:ui-monospace,monospace}
[data-tema="claro"]{--bg:#fff;--fg:#111;--accent:#2563eb}
[data-tema="oscuro"]{--bg:#111;--fg:#eee;--accent:#f59e0b}
body{background:var(--bg);color:var(--fg);margin:0;display:flex;justify-content:center}
main{max-width:800px;width:100%;padding:1rem;display:flex;flex-direction:column;height:100vh}
#log{flex:1;overflow-y:auto;background:#0002;padding:1rem;border:1px solid var(--fg);margin-bottom:.5rem;white-space:pre-line}
#estado{display:flex;flex-wrap:wrap;gap:.5rem;margin-bottom:.5rem;font-size:.9rem}
#estado span{padding:.2rem .4rem;border:1px solid var(--fg);border-radius:4px}
form{display:flex;gap:.5rem}
label{align-self:center}
input[type=text]{flex:1;background:var(--bg);color:var(--fg);border:1px solid var(--fg);padding:.5rem}
button{background:var(--accent);color:var(--bg);border:none;padding:.5rem .8rem;font-weight:bold;cursor:pointer}
button:focus,input:focus{outline:2px dashed var(--accent);outline-offset:2px}
footer{display:flex;flex-wrap:wrap;gap:.5rem;margin-top:.5rem}
@media(prefers-color-scheme:dark){:root:not([data-tema]){--bg:#111;--fg:#eee;--accent:#f59e0b}}
@media(prefers-color-scheme:light){:root:not([data-tema]){--bg:#fff;--fg:#111;--accent:#2563eb}}
</style>
</head>
<body>
<main>
<section id="panel">
<div id="log" role="log" aria-live="polite"></div>
</section>
<nav id="estado" aria-label="Estado"></nav>
<form id="form"><label for="entrada">Comando</label><input id="entrada" maxlength="80" autocomplete="off"><button type="submit">Enviar</button></form>
<footer>
<button data-cmd="mirar">Mirar</button>
<button data-cmd="inventario">Inventario</button>
<button data-cmd="estado">Estado</button>
<button data-cmd="misiones">Misiones</button>
<button data-cmd="santuario">Santuario</button>
<button data-cmd="guardar">Guardar</button>
<button data-cmd="cargar">Cargar</button>
<button id="temaBtn">Tema</button>
<button data-cmd="ayuda">Ayuda</button>
<button data-cmd="reset">Reset</button>
</footer>
</main>
<script type="application/json" id="seed">{
"salas":[
{"id":"entrada","nombre":"Entrada Musgosa","desc":"Una puerta h√∫meda abre paso.","conexiones":{"este":"pasillo"},"enemigos":["rata"],"npcs":["anciano"],"items":["espada","pocion"]},
{"id":"pasillo","nombre":"Pasillo de Susurros","desc":"Ecos extra√±os vibran.","conexiones":{"oeste":"entrada","este":"archivo","sur":"santuario"},"enemigos":["mimic"],"npcs":[],"items":["antidoto"]},
{"id":"archivo","nombre":"Archivo Polvoriento","desc":"Estantes repletos de pergaminos.","conexiones":{"oeste":"pasillo"},"enemigos":["jefe"],"npcs":["monje"]},
{"id":"santuario","nombre":"Nave del Santuario","desc":"Un altar rid√≠culamente brillante.","conexiones":{"norte":"pasillo"},"npcs":["monje"],"tieneSantuario":true}
],
"objetos":[
{"id":"pocion","nombre":"Poci√≥n Roja","tipo":"consumible","efectos":{"vida":20},"precio":10},
{"id":"antidoto","nombre":"Ant√≠doto","tipo":"consumible","efectos":{"estado":"veneno"},"precio":5},
{"id":"espada","nombre":"Espada Oxidada","tipo":"equipable","slot":"arma","efectos":{"atq":2},"precio":15},
{"id":"armadura","nombre":"Armadura de Cuero","tipo":"equipable","slot":"armadura","efectos":{"def":1},"precio":20},
{"id":"amu","nombre":"Amuleto Soso","tipo":"equipable","slot":"accesorio","efectos":{"manaMax":5},"precio":12},
{"id":"hongo","nombre":"Hongo Brillante","tipo":"clave","efectos":{},"precio":1}
],
"enemigos":[
{"id":"rata","nombre":"Rata Valiente","nivel":1,"vida":8,"atq":3,"def":0,"botin":{"oro":3,"drop":["hongo"]}},
{"id":"mimic","nombre":"Mimic Bromista","nivel":2,"vida":12,"atq":4,"def":1,"botin":{"oro":8}},
{"id":"fuego","nombre":"Esfera √çgnea","nivel":2,"vida":10,"atq":5,"def":0,"botin":{"oro":6}},
{"id":"esqueleto","nombre":"Esqueleto Perezoso","nivel":1,"vida":9,"atq":3,"def":1,"botin":{"oro":4}},
{"id":"jefe","nombre":"Bibliotecario C√≥smico","nivel":3,"vida":20,"atq":6,"def":2,"botin":{"oro":20,"drop":["espada"]},"esJefe":true}
],
"npcs":[
{"id":"anciano","nombre":"Anciano Olvidadizo","lineas":["Busca hongos para mi sopa.","Dicen que un cofre cobra vida al este."]},
{"id":"monje","nombre":"Monje Somnoliento","lineas":["El santuario cura, pero cobra caro.","Si no tienes oro, limpia los bancos."]}
],
"misiones":[
{"id":"m_hongos","tipo":"recolectar","objetivo":{"objeto":"hongo","cantidad":5},"progreso":{"actual":0},"recompensa":{"xp":10,"oro":5},"desc":"Recolecta 5 hongos brillantes."},
{"id":"m_mimic","tipo":"derrotar","objetivo":{"enemigo":"mimic","cantidad":1},"progreso":{"actual":0},"recompensa":{"xp":20,"oro":10},"desc":"Derrota al Mimic Bromista."},
{"id":"m_sant","tipo":"visitar","objetivo":{"sala":"santuario"},"progreso":{"visitado":false},"recompensa":{"xp":5,"oro":2},"desc":"Visita la Nave del Santuario."}
],
"santuario":{"precios":{"veneno":5,"quemadura":7,"aturdido":4,"sangrado":6},"descuento":0.2}
}
</script>
<script type="module">
"use strict";
// ==== Utils ====
const Utils=(()=>{const randInt=(a,b)=>Math.floor(Math.random()*(b-a+1))+a;const clamp=(n,a,b)=>Math.max(a,Math.min(b,n));const pick=a=>a[randInt(0,a.length-1)];const slug=s=>s.toLowerCase().normalize("NFD").replace(/[^a-z0-9]+/g,"");return{randInt,clamp,pick,slug};})();
// ==== RNG ====
const RNG=(()=>{let s=Date.now()%2147483647;function seed(n){s=n%2147483647;}function next(){return s=(s*16807)%2147483647;}function random(){return(next()-1)/2147483646;}return{seed,random,randInt:(a,b)=>Math.floor(random()*(b-a+1))+a};})();
// ==== UI ====
const UI=(()=>{const logEl=document.getElementById('log');const estadoEl=document.getElementById('estado');function log(t){const d=document.createElement('div');d.textContent=t;logEl.appendChild(d);logEl.scrollTop=logEl.scrollHeight;}function renderEstado(j,loc){estadoEl.innerHTML=`<span>‚ù§Ô∏è ${j.vida}/${j.vidaMax}</span><span>üîÆ ${j.mana}/${j.manaMax}</span><span>Lvl ${j.nivel}</span><span>üí∞ ${j.oro}</span><span>${loc.nombre}</span><span>${j.estados.map(e=>e.icono).join(' ')}</span>`;}function modal(text,mode){const dlg=document.createElement('dialog');dlg.innerHTML=`<form method="dialog" style="display:flex;flex-direction:column;gap:.5rem"><textarea style="width:60ch;height:10rem">${text||""}</textarea><div><button value="ok">OK</button></div></form>`;document.body.appendChild(dlg);dlg.showModal();dlg.addEventListener('close',()=>{if(mode==='importar'){Storage.importar(dlg.querySelector('textarea').value);}dlg.remove();});}return{log,renderEstado,modal};})();
// ==== Storage ====
const Storage=(()=>{const KEY='rpg_texto_save_v1';function save(state){localStorage.setItem(KEY,JSON.stringify(state));UI.log('Partida guardada.');}function load(){const raw=localStorage.getItem(KEY);if(!raw){UI.log('No hay partida.');return null;}try{return JSON.parse(raw);}catch(e){UI.log('Datos corruptos.');return null;}}function exportar(){const raw=localStorage.getItem(KEY)||'{}';UI.modal(raw);}function importar(json){try{const data=JSON.parse(json);if(data && data.jugador){localStorage.setItem(KEY,json);UI.log('Partida importada.');}else UI.log('JSON inv√°lido.');}catch(e){UI.log('JSON inv√°lido.');}}return{save,load,exportar,importar};})();
// ==== Datos ====
const Datos=JSON.parse(document.getElementById('seed').textContent);
// ==== Estado inicial ====
let state={jugador:{nombre:'',nivel:1,xp:0,vida:20,vidaMax:20,mana:10,manaMax:10,oro:5,atq:3,def:1,estados:[],equipo:{arma:null,armadura:null,accesorio:null},inventario:[]},ubicacion:'entrada',mundo:{salas:{},enemigos:{}},misiones:{},config:{tema:'auto',velocidad:1,verboso:true}};
// cargar mundo desde seed
Datos.salas.forEach(s=>{state.mundo.salas[s.id]=Object.assign({},s,{items:[...(s.items||[])],enemigos:[...s.enemigos]});});Datos.enemigos.forEach(e=>{state.mundo.enemigos[e.id]=Object.assign({},e);});Datos.misiones.forEach(m=>{state.misiones[m.id]=JSON.parse(JSON.stringify(m));});
// ==== Tema ====
const root=document.documentElement;function aplicarTema(){const t=state.config.tema;if(t==='auto')root.removeAttribute('data-tema');else root.setAttribute('data-tema',t);}document.getElementById('temaBtn').onclick=()=>{const orden=['auto','claro','oscuro'];const i=orden.indexOf(state.config.tema);state.config.tema=orden[(i+1)%orden.length];aplicarTema();};aplicarTema();
// ==== Utilidades jugador ====
function nivelUp(){state.jugador.nivel++;state.jugador.vidaMax+=5;state.jugador.manaMax+=3;state.jugador.atq++;state.jugador.def++;UI.log('Subes a nivel '+state.jugador.nivel+'. Te sientes ligeramente menos inepto.');}
function ganarXP(x){state.jugador.xp+=x;UI.log('Ganas '+x+' xp.');if(state.jugador.xp>=state.jugador.nivel*20){state.jugador.xp=0;nivelUp();}}
function curarTodo(){state.jugador.vida=state.jugador.vidaMax;state.jugador.mana=state.jugador.manaMax;state.jugador.estados=[];}
// ==== Misiones ====
function progMision(tipo,id){const m=state.misiones[id];if(!m) return;if(m.tipo==='recolectar'){m.progreso.actual++;if(m.progreso.actual>=m.objetivo.cantidad){completarMision(m);}}if(m.tipo==='derrotar'){m.progreso.actual++;if(m.progreso.actual>=m.objetivo.cantidad){completarMision(m);}}if(m.tipo==='visitar'){m.progreso.visitado=true;completarMision(m);}}
function completarMision(m){if(m.completada)return; m.completada=true;UI.log('Misi√≥n completada: '+m.desc);state.jugador.oro+=m.recompensa.oro;ganarXP(m.recompensa.xp);if(m.recompensa.objeto)state.jugador.inventario.push(m.recompensa.objeto);}
// ==== Inventario ====
function obtenerItem(id){return Datos.objetos.find(o=>o.id===id);}function equipar(id){const it=obtenerItem(id);if(!it||it.tipo!=='equipable'){UI.log('No puedes equipar eso.');return;}const slot=it.slot;const actual=state.jugador.equipo[slot];if(actual)state.jugador.inventario.push(actual);state.jugador.equipo[slot]=id;state.jugador.inventario=state.jugador.inventario.filter(i=>i!==id);aplicarStats();UI.log('Equipas '+it.nombre+'.');}
function desequipar(slot){const id=state.jugador.equipo[slot];if(!id){UI.log('No llevas nada en '+slot);return;}state.jugador.inventario.push(id);state.jugador.equipo[slot]=null;aplicarStats();UI.log('Desequipas '+obtenerItem(id).nombre+'.');}
function aplicarStats(){state.jugador.atq=3;state.jugador.def=1;state.jugador.manaMax=10;['arma','armadura','accesorio'].forEach(s=>{const id=state.jugador.equipo[s];if(id){const it=obtenerItem(id);if(it.efectos.atq)state.jugador.atq+=it.efectos.atq;if(it.efectos.def)state.jugador.def+=it.efectos.def;if(it.efectos.manaMax)state.jugador.manaMax+=it.efectos.manaMax;}});}
// ==== Mundo ====
function salaActual(){return state.mundo.salas[state.ubicacion];}
function mover(dir){const sala=salaActual();const dest=sala.conexiones[dir];if(dest){state.ubicacion=dest;UI.log('Vas hacia '+dir+'.');visitarSala();}else UI.log('No hay camino al '+dir+'.');}
function visitarSala(){const sala=salaActual();UI.log(sala.nombre+': '+sala.desc);if(sala.enemigos.length)UI.log('Enemigos: '+sala.enemigos.map(id=>state.mundo.enemigos[id].nombre).join(', '));if(sala.npcs)UI.log('Habitantes: '+sala.npcs.map(id=>Datos.npcs.find(n=>n.id===id).nombre).join(', '));if(sala.tieneSantuario)UI.log('Aqu√≠ hay un santuario resplandeciente.');if(state.misiones['m_sant']&&sala.id==='santuario')progMision('visitar','m_sant');render();}
// ==== Combate ====
let combate=null;const estadoIconos={veneno:'‚ò†',quemadura:'üî•',aturdido:'‚úñ',sangrado:'ü©∏'};function iniciarCombate(id){const sala=salaActual();if(!sala.enemigos.includes(id)){UI.log('No ves eso aqu√≠.');return;}const enemigo=Object.assign({estados:[]},state.mundo.enemigos[id]);combate={enemigo};UI.log('¬°'+enemigo.nombre+' aparece!');if(enemigo.esJefe){presentacionJefe(enemigo);}turnoJugador();}
function presentacionJefe(en){const plant=[`${en.nombre} se materializa burl√°ndose de tu peinado, ${state.jugador.nombre}.`,`${en.nombre} aplaude ir√≥nicamente tu arma ${equipoNombre('arma')}.`,`Desde el ${salaActual().nombre}, ${en.nombre} critica tus estad√≠sticas promedio.`,`${en.nombre} te compara con una calculadora rota, ${state.jugador.nombre}.`,`El universo suspira al ver tu ${equipoNombre('arma')}, dice ${en.nombre}.`,`${en.nombre} pregunta si entrenaste en un tutorial de cocina.`];UI.log(Utils.pick(plant));}
function equipoNombre(slot){const id=state.jugador.equipo[slot];return id?obtenerItem(id).nombre:'pu√±os';}
function turnoJugador(){UI.log('Tu turno.');}
function procesarEstados(obj){
  let at=false;const out=[];
  obj.estados=obj.estados.filter(e=>{
    e.turnos--;
    if(e.tipo==='veneno'){obj.vida-=2;out.push('Veneno da√±a 2.');}
    if(e.tipo==='quemadura'){obj.vida-=2;out.push('Quemadura arde 2.');}
    if(e.tipo==='sangrado'){e.pot=(e.pot||1);obj.vida-=e.pot;out.push('Sangrado '+e.pot);e.pot++;}
    if(e.tipo==='aturdido'){at=true;}
    return e.turnos>0;
  });
  return {texto:out.join(' '),aturdido:at};
}
function aplicarEstado(obj,tipo,turnos){obj.estados.push({tipo,turnos,icono:estadoIconos[tipo]});}
function ataque(atk,def){let dmg=atk.atq+RNG.randInt(-2,2)-def.def;dmg=dmg<1?1:dmg;const crit=RNG.randInt(1,10)===1;if(crit)dmg=Math.floor(dmg*1.5);def.vida-=dmg;return{dmg,crit};}
function enemigoVivo(){return combate&&combate.enemigo.vida>0;}
function resolverTurno(){
  if(!combate)return;
  const e=combate.enemigo;
  const p=state.jugador;
  const pj=procesarEstados(p);
  if(p.vida<=0){UI.log('Has ca√≠do. Fin.');combate=null;return;}
  const ee=procesarEstados(e);
  if(e.vida<=0){UI.log('Enemigo derrotado.');finCombate();return;}
  if(ee.aturdido){
    UI.log('El enemigo est√° aturdido.');
  }else{
    const res=ataque(e,p);
    if(e.id==='rata'&&RNG.randInt(1,3)===1)aplicarEstado(p,'veneno',3);
    if(e.id==='fuego'&&RNG.randInt(1,3)===1)aplicarEstado(p,'quemadura',2);
    if(e.id==='esqueleto'&&RNG.randInt(1,3)===1)aplicarEstado(p,'sangrado',3);
    UI.log(`${e.nombre} golpea por ${res.dmg}`+(res.crit?' ¬°Cr√≠tico!':''));
    if(p.vida<=0){UI.log('Has sido derrotado. Fin.');combate=null;return;}
  }
  const txt=[pj.texto,ee.texto].filter(Boolean).join(' ');
  if(txt)UI.log(txt);
}
function finCombate(){const e=combate.enemigo;const sala=salaActual();sala.enemigos=sala.enemigos.filter(i=>i!==e.id);state.jugador.oro+=e.botin.oro;UI.log(`Obtienes ${e.botin.oro} oro.`);if(e.botin.drop){e.botin.drop.forEach(id=>{sala.items.push(id);UI.log('Cae '+obtenerItem(id).nombre);});}if(e.esJefe)UI.log('El jefe cae soltando un suspiro sarc√°stico.');ganarXP(e.nivel*10);if(e.id=="mimic")progMision("derrotar","m_mimic");combate=null;}
function comandoAtacar(arg){if(combate){const e=combate.enemigo;const res=ataque(state.jugador,e);UI.log(`Atacas a ${e.nombre} por ${res.dmg}`+(res.crit?' ¬°Cr√≠tico!':''));if(e.vida<=0){UI.log('Enemigo derrotado.');finCombate();}else{resolverTurno();}return;}else iniciarCombate(arg);}
function comandoHabilidad(arg){
  if(!combate){UI.log('No est√°s en combate.');return;}
  const p=state.jugador,e=combate.enemigo;
  if(arg==='golpe'){
    if(p.mana<2){UI.log('Sin mana.');return;}
    p.mana-=2;
    const res=ataque({atq:p.atq+2},e);
    UI.log(`Golpe Firme hace ${res.dmg}`);
    if(e.vida<=0){finCombate();return;}
  }else if(arg==='guardia'){
    if(p.mana<3){UI.log('Sin mana.');return;}
    p.mana-=3;
    aplicarEstado(e,'aturdido',1);
    UI.log('Guardia M√≠stica aturde al enemigo.');
  }else{
    UI.log('Habilidad desconocida.');return;
  }
  resolverTurno();
}
function comandoHuir(){if(!combate){UI.log('No hay peligro de qu√© huir.');return;}if(RNG.randInt(0,1)){UI.log('Escapas.');combate=null;}else{UI.log('Fallas al huir.');resolverTurno();}}
// ==== Santuario ====
function comandoSantuario(arg){const sala=salaActual();if(!sala.tieneSantuario){UI.log('No hay santuario aqu√≠.');return;}if(!arg){if(!state.jugador.estados.length){UI.log('El santuario bosteza: no tienes nada que curar.');return;}UI.log('Estados: '+state.jugador.estados.map(e=>e.tipo).join(', ')+'. Usa "santuario curar <estado|todo>"');return;}const partes=arg.split(' ');if(partes[0]!=='curar'){UI.log('Sintaxis: santuario curar <estado|todo>');return;}const objetivo=partes[1];const precios=Datos.santuario.precios;if(objetivo==='todo'){const costo=state.jugador.estados.reduce((s,e)=>s+precios[e.tipo],0);const total=Math.floor(costo*(1-Datos.santuario.descuento));if(state.jugador.oro>=total){state.jugador.oro-=total;curarTodo();UI.log('El santuario te roc√≠a agua con sabor a burocracia. Te curas.');}else{UI.log('Te falta oro. Escribe "limpiar" para fregar bancos por monedas.');}}else{const st=state.jugador.estados.find(e=>e.tipo===objetivo);if(!st){UI.log('No tienes ese estado.');return;}const precio=precios[objetivo];if(state.jugador.oro>=precio){state.jugador.oro-=precio;state.jugador.estados=state.jugador.estados.filter(e=>e.tipo!==objetivo);UI.log('El santuario te cura con un spray rid√≠culamente caro.');}else UI.log('Te falta oro. Escribe "limpiar" para fregar bancos por monedas.');}}
function comandoLimpiar(){const sala=salaActual();if(!sala.tieneSantuario){UI.log('No hay nada que limpiar.');return;}state.jugador.oro+=2;UI.log('Limpias bancos pegajosos. Obtienes 2 oro.');}
// ==== Comandos ====
const comandos=new Map();function registrar(v,fn,ay){comandos.set(v,{fn,ay});}
function alias(v){return{m:'mirar',i:'inventario',e:'estado',g:'guardar'}[v]||v;}
function procesar(str){str=str.trim().toLowerCase();if(!str)return;const [verbo,...rest]=str.split(' ');const v=alias(verbo);const arg=rest.join(' ');const cmd=comandos.get(v);if(cmd){cmd.fn(arg);}else UI.log('Comando desconocido.');render();}
// ==== Registro de comandos ====
registrar('ayuda',()=>{UI.log('Comandos: '+Array.from(comandos.keys()).join(', '));});
registrar('mirar',arg=>{if(arg){UI.log('No ves eso con detalle.');return;}visitarSala();});
registrar('ir',dir=>{mover(dir);});
registrar('hablar',id=>{const sala=salaActual();if(!sala.npcs||!sala.npcs.includes(id)){UI.log('No hay con qui√©n.');return;}const npc=Datos.npcs.find(n=>n.id===id);UI.log(Utils.pick(npc.lineas));});
registrar('tomar',id=>{const sala=salaActual();const idx=sala.items.indexOf(id);if(idx===-1){UI.log('No ves eso.');return;}state.jugador.inventario.push(id);sala.items.splice(idx,1);UI.log('Tomas '+obtenerItem(id).nombre);if(id==='hongo')progMision('recolectar','m_hongos');});
registrar('soltar',id=>{const idx=state.jugador.inventario.indexOf(id);if(idx===-1){UI.log('No lo tienes.');return;}state.jugador.inventario.splice(idx,1);salaActual().items.push(id);UI.log('Suelto '+obtenerItem(id).nombre);});
registrar('inventario',()=>{UI.log('Inventario: '+state.jugador.inventario.map(id=>obtenerItem(id).nombre).join(', ')||'vac√≠o');});
registrar('usar',id=>{const idx=state.jugador.inventario.indexOf(id);if(idx===-1){UI.log('No lo tienes.');return;}const it=obtenerItem(id);if(it.tipo!=='consumible'){UI.log('No es consumible.');return;}if(it.efectos.vida){state.jugador.vida=Utils.clamp(state.jugador.vida+it.efectos.vida,0,state.jugador.vidaMax);}if(it.efectos.estado){state.jugador.estados=state.jugador.estados.filter(e=>e.tipo!==it.efectos.estado);}state.jugador.inventario.splice(idx,1);UI.log('Usas '+it.nombre);});
registrar('equipar',equipar);registrar('desequipar',desequipar);
registrar('estado',()=>{const j=state.jugador;UI.log(`Vida ${j.vida}/${j.vidaMax}, Mana ${j.mana}/${j.manaMax}, Atq ${j.atq}, Def ${j.def}`);UI.log('Equipo: '+Object.entries(j.equipo).map(([s,id])=>`${s}:${id?obtenerItem(id).nombre:'--'}`).join(' '));UI.log('Estados: '+(j.estados.map(e=>e.tipo).join(', ')||'ninguno'));});
registrar('atacar',comandoAtacar);
registrar('habilidad',comandoHabilidad);
registrar('huir',comandoHuir);
registrar('misiones',()=>{Object.values(state.misiones).forEach(m=>{if(m.tipo==='recolectar')UI.log(`${m.desc} (${m.progreso.actual}/${m.objetivo.cantidad})`);else if(m.tipo==='derrotar')UI.log(`${m.desc} (${m.progreso.actual}/${m.objetivo.cantidad})`);else UI.log(`${m.desc} (${m.progreso.visitado?1:0}/1)`);});});
registrar('santuario',comandoSantuario);registrar('limpiar',comandoLimpiar);
registrar('guardar',()=>Storage.save(state));
registrar('cargar',()=>{const data=Storage.load();if(data){state=data;aplicarTema();render();UI.log('Partida cargada.');}});
registrar('exportar',()=>Storage.exportar());
registrar('importar',()=>UI.modal('', 'importar'));
registrar('config',str=>{const [p,v]=str.split(' ');if(p==='tema'){state.config.tema=v;aplicarTema();}UI.log('Config actualizada.');});
registrar('salir',()=>{UI.log('Recuerda guardar antes de cerrar.');});
registrar('reset',()=>{localStorage.clear();location.reload();});
// ==== Render ====
function render(){UI.renderEstado(state.jugador,salaActual());}
// ==== Entrada ====
const form=document.getElementById('form');const inp=document.getElementById('entrada');form.onsubmit=e=>{e.preventDefault();procesar(inp.value);inp.value='';};document.addEventListener('keydown',e=>{if(e.key==='/' && document.activeElement!==inp){e.preventDefault();inp.focus();}if(e.key==='Escape'){inp.value='';}if(e.key==='Tab'){const pref=inp.value.trim();const opts=Array.from(comandos.keys()).filter(c=>c.startsWith(pref));if(opts.length===1){e.preventDefault();inp.value=opts[0]+' ';}}});document.querySelectorAll('[data-cmd]').forEach(b=>b.onclick=()=>{procesar(b.getAttribute('data-cmd'));});
// ==== Inicio ====
function bootstrap(){const save=Storage.load();if(save){state=save;aplicarTema();UI.log('Partida cargada.');}if(!state.jugador.nombre){state.jugador.nombre=prompt('¬øNombre?')||'An√≥nimo';UI.log('Bienvenido '+state.jugador.nombre+'. Escribe ayuda, mirar, estado, misiones.');}visitarSala();render();}
bootstrap();
</script>
</body>
</html>
